function [t,y] =curve_fitting_dormancy_model_logistic growth

clear all
close all
%clc

DataPBM = xlsread('VarName1{1,1}');



tPdata = DataPBM(1,1:6)
Pdata = log10(DataPBM(2,1:6));
%Pdata = DataPBM(4,1:10);
tMdata = DataPBM(1,2:15);
Mdata = DataPBM(2,2:15);

tBdata = DataPBM(1,1:15);
Bdata = DataPBM(3,1:15);

tDataforFitting = tBdata;
ydataforFitting = [Pdata Bdata Mdata];


% subplot(3,1,1);
%  plot(tPdata, Pdata, '-o')
%  xlabel('days')
%  ylabel('pathogen')
% 
% subplot(3,1,2);
%  plot(tBdata, Bdata,'-r')
%   xlabel('days')
%  ylabel('IgM')
% 
% subplot(3,1,3);
%  plot(tMdata, Mdata,'-*g')
%   xlabel('days')
%  ylabel('IgG')
 
plot(tPdata, Pdata, '-o',tBdata, Bdata,'-sr',tMdata, Mdata,'-*g')
format long

function dy = model_PBM(t,y,k)

dy = zeros(3,1);

dy(1) = (k(1)*(1 - y(1)/k(9)) - k(2)*y(2) - k(3)*y(3))*y(1);
dy(2) = k(4)*y(2)*y(1)-(k(5) + k(6))*y(2);
dy(3) = k(5)*y(2) + k(7)*y(1) - k(8)*y(3);

end




    function B = PBM_model(k,tPdata)

    [t,y] = ode23s(@(t,y)(model_PBM(t,y,k)),tPdata,[1.700983104969447 0.0119 0.01]);
    
%        B = y(:,1)';
%     
       B = log10(y(:,1)');

    end
% 
% k =[7 0.00001 0.000001 0.0003 0.1 0.2 0.00001  0.001 48000];
% k =1.0e+04 *[0.000819460864982   0.000000272167282   0.000000141088225   0.000000047549168...
%              0.000000000303676   0.000047467236760   0.000020843364074   0.000002164289891...
%              4.650985853533713]
% 
% k =1.0e+04 *[0.000822605631291   0.000000385846368   0.000000155737680   0.000000047645754...
%              0.000000000069026   0.000048249020615   0.000019743492449   0.000002223787816...
%              4.648517567880907];
%          
% k = 1.0e+04 *[0.000950594065037   0.000000312356354   0.000000139657749   0.000000048882918...
%               0.000000000531982   0.000057307896647   0.000023383121202   0.000000014973642...
%               4.578772353090431];   
          
% k =1.0e+04 *[0.000957633232948   0.000000343055852   0.000000156566034   0.000000048774548...
%              0.000000398811874   0.000057236224895   0.000021100222852   0.000000000076159...
%              4.575303032134830];
% 
% k = 1.0e+04 *[0.000964267309550   0.000000402916332   0.000000173562380   0.000000048562505...
%               0.000000794121875   0.000057138079842   0.000019331481771   0.000000000042494...
%               4.571124312817993]  
% k =1.0e+04 *[0.000971384504090   0.000000332308798   0.000000159025677   0.000000049900965...
%              0.000000394732759   0.000059030930129   0.000021654896784   0.000000000003313...
%              4.564493803874192]

% k =1.0e+04 *[0.000976447078629   0.000000312005921   0.000000168956264   0.000000050512396...
%              0.000000000072633   0.000059659186646   0.000020746473000   0.000000008533642...
%              4.550506616177789];
         
% k =1.0e+04 *[0.000977898177701   0.000000296779862   0.000000175131440   0.000000050887238...
%              0.000000000807176   0.000060104356772   0.000020145871719   0.000000015996645...
% %              4.546435748220429];
% k =1.0e+04 *[0.001028482258289   0.000000145619536   0.000000281782379   0.000000056692930...
%              0.000000012209388   0.000063816960335   0.000014095184144   0.000000000004930...
%              4.355320955212568];
% %          
% k =1.0e+04 *[0.001060593757135   0.000000105198939   0.000000314403369   0.000000059263285...
%              0.000000028712481   0.000065862903115   0.000013399266447   0.000000000001747...
%              4.308256757165542];
% k =1.0e+04 *[0.001274350219819   0.000000015082553   0.000000536475408   0.000000061851655...
%              0.000000205186902   0.000070896701216   0.000008166270583   0.000000000028661...
%              4.297489611511259]; 
% k =1.0e+04 *[0.001287374166852   0.000000011786626   0.000000548547226   0.000000058370659...
%              0.000000142353955   0.000072114450903   0.000007576306823   0.000000000284887...
%              4.736842922134045];  
% k =1.0e+04 *[0.001317729274809   0.000000008882150   0.000000501516799   0.000000053946386...
%              0.000000109295190   0.000072209548405   0.000007763196340   0.000000000098502...
%              5.298576734986495];
k =1.0e+04 *[0.001284015552205   0.000000008617151   0.000000516828737   0.000000053525015...
             0.000000060077750   0.000072300527871   0.000007452296979   0.000000000079889...
             5.550710364803346]
         
lb = [ 0 0 0 0 0 0 0 0 0];

%  for i=1:15
%  [k,resnorm] = lsqcurvefit(@PBM_model,k,tPdata,Pdata,lb,[],...
%                             optimset('Disp','iter','TolX',10^(-14),'TolFun',10^(-14)))
%  end
 
 figure
[t,y] = ode23s(@(t,y)model_PBM(t,y,k),tPdata,[1.700983104969447 0.0119 0])
 plot(tPdata, Pdata,'-*b', t, log10(y(:,1)),'-r')
 xlabel('days')
 ylabel('pathogen')
 legend('data','fitting')
 figure
  plot(tPdata, 10.^Pdata,'-*b', t, y(:,1), '-r',t,y(:,2), ':m',t,y(:,3), '-g','LineWidth',2)
%plot(tPdata, Pdata,'-*b', t, y(:,1), '-r')
 xlabel('days')
 %ylabel('pathogen')
 legend('data','P','B','M')
  figure
  plot(t,y(:,2), '-r',t,y(:,3), '-g')
%plot(tPdata, Pdata,'-*b', t, y(:,1), '-r')
 xlabel('days')
 ylabel('IgG,IgM')
 legend('B','M')
%  legend('data','fitting','B','M')



 end
